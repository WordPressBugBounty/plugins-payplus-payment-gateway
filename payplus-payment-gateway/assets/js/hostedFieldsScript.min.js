const hf=new PayPlusHostedFieldsDom;var resp=JSON.parse(payplus_script_hosted.hostedResponse);let payload;const pageLang=document.documentElement.lang,month="he-IL"!==pageLang?"Month":"חודש",year="he-IL"!==pageLang?"Year":"שנה",yearMonth="he-IL"!==pageLang?month+" / "+year:year+" / "+month,direction="he-IL"!==pageLang?"left":"right",opposite="right"===direction?"left":"right";var origin=window.location.origin;let viImage="background-image: url("+origin+"/wp-content/plugins/payplus-payment-gateway/assets/images/vi.svg);background-repeat: no-repeat;background-position: "+opposite+" center";viImage="";const testMode=payplus_script_hosted.testMode;function putHostedFields(){var e=jQuery("#payment_method_payplus-payment-gateway"),t=jQuery(".pp_iframe_h"),r=jQuery("body > div.container.hostedFields");e.length&&t.length&&r.length&&t.append(r)}function showElement(e,t){e.style.display=t,e.style.opacity="1",e.style.transition="opacity 1s",setTimeout(()=>{e.style.opacity="1"},10)}function hideElement(e){e.style.opacity="0",e.style.transition="opacity 1s",setTimeout(()=>{e.style.display="none"},1e3)}function showError(e,t){const r=document.querySelector(".payment-error-message"),o=document.querySelector(".loader-countdown"),a=document.querySelector(".progress-ring__circle"),n=document.querySelector(".error-message"),s=document.querySelector(".error-code");let i,l=5;o.textContent=l,e=null!=payplus_script_hosted.allErrors.Errors[e]?payplus_script_hosted.allErrors.Errors[e]:e,t=null!=payplus_script_hosted.allErrors.Fields[t]?payplus_script_hosted.allErrors.Fields[t]:t,showElement(r,"flex");let d="en-US"!==pageLang?"שגיאה: ":"Error: ";n.innerText=d+e,i="string"!=typeof t?"en-US"!==pageLang?"קוד שגיאה: ":"Error code: ":"en-US"!==pageLang?"שדה: ":"Field: ",null!==t&&(s.innerText=t.toString().length>0?i+t:t);!!document.querySelector('div[data-block-name="woocommerce/checkout"]')&&alert(n.innerText+"\n"+s.innerText);const p=a.r.baseVal.value,c=2*Math.PI*p;a.style.strokeDasharray=`${c}`,a.style.strokeDashoffset="0";const u=setInterval(()=>{o.textContent=l;const e=c-l/5*c+15;a.style.strokeDashoffset=e,1===l?(clearInterval(u),hideElement(r)):l--},1e3)}let $overlay;hf.SetMainFields({cc:{elmSelector:"#cc",wrapperElmSelector:"#cc-wrapper",config:{placeholder:"1234 1234 1234 1234",fontName:"almoni"}},expiryy:{elmSelector:"#expiryy",wrapperElmSelector:".expiry-wrapper",config:{placeholder:year,fontName:"almoni"}},expirym:{elmSelector:"#expirym",wrapperElmSelector:".expiry-wrapper",config:{placeholder:month,fontName:"almoni"}},expiry:{elmSelector:"#expiry",wrapperElmSelector:".expiry-wrapper-full",config:{placeholder:yearMonth,fontName:"almoni"}},cvv:{elmSelector:"#cvv",wrapperElmSelector:"#cvv-wrapper",config:{placeholder:"CVV",fontName:"almoni"}}}).AddField("card_holder_id","#id-number","#id-number-wrapper").AddField("payments","#payments","#payments-wrapper").AddField("card_holder_name","#card-holder-name","#card-holder-name-wrapper").AddField("card_holder_phone",".card-holder-phone",".card-holder-phone-wrapper").AddField("card_holder_phone_prefix",".card-holder-phone-prefix",".card-holder-phone-prefix-wrapper").AddField("customer_name","[name=customer_name]",".customer_name-wrapper").AddField("vat_number","[name=customer_id]",".customer_id-wrapper").AddField("phone","[name=phone]",".phone-wrapper").AddField("email","[name=email]",".email-wrapper").AddField("contact_address","[name=address]",".address-wrapper").AddField("contact_country","[name=country]",".country-wrapper").AddField("custom_invoice_name","#invoice-name","#invoice-name-wrapper").AddField("notes","[name=notes]",".notes-wrapper").SetRecaptcha("#recaptcha").SetHostedFieldsStyles("::placeholder {color: #A2ADB5;} .hf-inp-name-cc {font-size:1rem !important;text-align: "+direction+"; background-image: url("+origin+"/wp-content/plugins/payplus-payment-gateway/assets/images/lock.svg);background-repeat: no-repeat;background-position: "+opposite+" center;} .hf-inp-name-cvv {font-size:1rem !important;text-align: "+direction+"; background-image: url("+origin+"/wp-content/plugins/payplus-payment-gateway/assets/images/cvv.svg);background-repeat: no-repeat;background-position: "+opposite+"} .hf-inp-name-expirym {text-align: "+direction+"; font-size: 1rem} .hf-inp-name-expiryy {text-align: "+direction+"; font-size: 1rem; "+viImage+"} .hf-inp-name-expiry {text-align: "+direction+"; font-size: 1rem; "+viImage+";background-repeat: no-repeat;background-position: "+opposite+" center;}"),jQuery(()=>{if(window.innerWidth<768){const e=`\n            .iframe-wrapper {\n                width: 100%;\n                max-width: 100%;\n                overflow: hidden;\n                position: relative;\n            }\n            .hsted-Flds--r-secure3ds-iframe {\n                transform: scale(0.65);\n                transform-origin: top left;\n                width: 150% !important;\n                height: 500px;\n                border: none;\n                left: 5px !important;\n                top: 25% !important;\n                ${"he-IL"===pageLang||"rtl"===document.dir?"right: unset !important;":""}\n            }\n        `;jQuery("<style>").text(e).appendTo("head");new MutationObserver(function(e){jQuery(".hsted-Flds--r-secure3ds-iframe").each(function(){const e=jQuery(this);e.parent().hasClass("iframe-wrapper")||e.wrap('<div class="iframe-wrapper"></div>')})}).observe(document.body,{childList:!0,subtree:!0}),console.log("MutationObserver started")}const e=!!document.querySelector('div[data-block-name="woocommerce/checkout"]');if("he-IL"===pageLang&&window.innerWidth<400&&jQuery("#payments-wrapper").css("direction","ltr"),(e||!e&&!payplus_script_hosted.showSubmitButton)&&(jQuery("#submit-payment").css("visibility","hidden"),jQuery("#submit-payment").css("display","none")),payplus_script_hosted.isHideLoaderLogo){var t=payplus_script_hosted.processingText||"Processing Payment",r=!!payplus_script_hosted.isRtl,o=r?"'AlmoniMLv5AAA', Arial, sans-serif":"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif",a="http://www.w3.org/2000/svg",n=document.createElementNS(a,"svg");n.setAttribute("xmlns",a),n.setAttribute("viewBox","0 0 120 28"),n.setAttribute("width","120"),n.setAttribute("height","26"),n.style.cssText="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:block;overflow:visible;pointer-events:none;";var s=document.createElementNS(a,"text");s.setAttribute("x","50%"),s.setAttribute("y","50%"),s.setAttribute("text-anchor","middle"),s.setAttribute("dominant-baseline","middle"),s.setAttribute("font-family",o),s.setAttribute("font-size","12"),s.setAttribute("font-weight","600"),s.setAttribute("fill","#ffffff"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","2.5"),s.setAttribute("paint-order","stroke fill"),r&&s.setAttribute("direction","rtl"),s.textContent=t,n.appendChild(s),jQuery(".blocks-loader-text").addClass("no-image").css({overflow:"visible",background:"transparent"}).append(n)}!async function(t){try{if("success"==t.results.status){try{await hf.CreatePaymentPage({hosted_fields_uuid:t.data.hosted_fields_uuid,page_request_uid:t.data.page_request_uid,origin:testMode?"https://restapidev.payplus.co.il":"https://restapi.payplus.co.il"})}catch(e){alert(e)}hf.InitPaymentPage.then(t=>{e&&(console.log("checkout page (hosted)?",e),jQuery(document).ready(function(){let e=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-hostedfields");!function t(){if(e=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-hostedfields"),e){const t=e.closest("div");if(t){const a=document.querySelector("body > div.container.hostedFields");var r=jQuery("body > div.container.hostedFields");const n=document.querySelector("#payment-form");if(a.className="pp_iframe_h",t.appendChild(a),a.style.display="none",a.style.justifyContent="center",a.style.flexDirection="column",a.style.alignItems="center",n.style.marginBottom="4%",n.style.width="99%",!jQuery(".hf-save").length){var o=jQuery('<p class="hf-save form-row"><label for="save_token_checkbox"><input type="checkbox" name="wc-save-token" id="save_token_checkbox" value="1" style="margin:0 10px 0 10px;"/> '+payplus_script_hosted.saveCreditCard+"</label></p>");payplus_script_hosted.isLoggedIn&&payplus_script_hosted.isSavingCerditCards&&r.append(o)}e.addEventListener("click",t=>{e.checked&&(a.style.display="flex")});const s=e.closest(".wc-block-components-checkout-step__container");if(s){s.querySelectorAll("input[type='checkbox'], input[type='radio']").forEach(t=>{t!==e&&t.addEventListener("click",e=>{t.checked&&"save_token_checkbox"!==e.target.id&&(a.style.display="none")})})}}else console.log("No parent div found.")}else setTimeout(function(){t()},1e3)}()})),jQuery("#create-payment-form").hide(),jQuery("#payment-form").css("display","flex")})}else alert(t.results.message),location.reload()}catch(e){jQuery("#error").append("<div>Error:</div>"),jQuery("#error").append(`<pre>${JSON.stringify(t,null,2)}</pre>`)}}(resp)}),hf.Upon("pp_pageExpired",e=>{console.log(e),jQuery("#status").val("Page Expired"),jQuery.ajax({type:"post",dataType:"json",url:payplus_script_hosted.ajax_url,data:{action:"regenerate-hosted-link",_ajax_nonce:payplus_script_hosted.frontNonce},success:function(e){console.log(e)},error:function(e,t,r){console.log(e,t,r)}});const t=document.createElement("div");t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.backgroundColor="#fff",t.style.padding="20px",t.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.1)",t.style.zIndex="10000",t.innerHTML=`\n    <p>${"he-IL"!==pageLang?"Page Expired. Please refresh the page and try again.":"תוקף הדף פג. אנא רענן/י את הדף ונסה/י שוב."}</p>\n    <button id="popup-ok-button">${"he-IL"!==pageLang?"OK":"אישור"}</button>\n`,document.body.appendChild(t),document.getElementById("popup-ok-button").addEventListener("click",()=>{document.body.removeChild(t),window.location.href=window.location.href})}),hf.Upon("pp_noAttemptedRemaining",e=>{alert("No more attempts remaining")}),hf.Upon("pp_responseFromServer",e=>{let t="";try{t=JSON.stringify(e.detail,null,2)}catch(r){console.log("Error parsing response: ",r),t=e.detail}let r=!!jQuery("#save_token_checkbox").is(":checked");if(e.detail?.data?.error||"reject"===e.detail?.data?.status)return showError(e.detail.data.message,""),jQuery(".blocks-payplus_loader_hosted").fadeOut(),overlay(!0),void(isCheckout&&location.reload());if(e.detail.errors){let t=null===e.detail.errors[0].message?e.detail.results.description:e.detail.errors[0].message,r=null===e.detail.errors[0].message?e.detail.results.error_code:e.detail.errors[0].field;const o=e=>{showError(t,r),jQuery(".blocks-payplus_loader_hosted").fadeOut(),overlay(!0)};!["not-authorize-success","payment-is-still-in-process"].includes(t)&&o()}if("000"===e.detail.data?.status_code){let t=e.detail.data.more_info,o=e.detail.data.token_uid,a=e.detail.data.page_request_uid;jQuery.ajax({type:"post",dataType:"json",url:payplus_script_hosted.ajax_url,data:{action:"make-hosted-payment",order_id:t,token:o,saveToken:r,page_request_uid:a,_ajax_nonce:payplus_script_hosted.frontNonce},success:function(e){console.log("Hosted payment response: ",e),jQuery.ajax({url:payplus_script_hosted.ajax_url,type:"POST",data:{action:"complete_order",order_id:t,payment_response:e,_ajax_nonce:payplus_script_hosted.frontNonce},success:function(e){console.log("final response: ",e),e.success?(jQuery(window).off("beforeunload"),window.location.href=e.data.redirect_url):(alert("Order completion failed(Please try again): "+(e.message||e.data.message)),location.reload())},error:function(e,t,r){alert("Error completing order: "+r),location.reload()}})},error:function(e,t,r){alert("Error making hosted payment: "+r),location.reload()}})}}),hf.Upon("pp_submitProcess",e=>{});const overlay=(e=!1)=>{e?$overlay&&($overlay.remove(),jQuery("body").css({overflow:""}),$overlay=null):$overlay||($overlay=jQuery("<div></div>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999,cursor:"not-allowed"}).appendTo("body"),jQuery("body").css({overflow:"hidden"}),$overlay.on("click",function(e){e.stopPropagation(),e.preventDefault()}))};jQuery(document).ready(function(){jQuery("#card-holder-name").on("blur",function(){let e=jQuery(this).val().trim();/^[a-zA-Z]+ [a-zA-Z]+$/.test(e)?jQuery(this).addClass("validated"):jQuery(this).removeClass("validated")}),jQuery("#id-number").on("blur",function(){let e=jQuery(this).val().trim();/^\d{9}$/.test(e)?jQuery(this).addClass("validated"):jQuery(this).removeClass("validated")})});