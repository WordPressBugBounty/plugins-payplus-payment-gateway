const{CHECKOUT_STORE_KEY:CHECKOUT_STORE_KEY}=window.wc.wcBlocksData,{PAYMENT_STORE_KEY:PAYMENT_STORE_KEY}=window.wc.wcBlocksData,store=wp.data.select(CHECKOUT_STORE_KEY),payment=wp.data.select(PAYMENT_STORE_KEY),hasOrder=store.hasOrder(),isCheckout=!!document.querySelector('div[data-block-name="woocommerce/checkout"]');if(isCheckout||hasOrder){console.log("checkout page?",isCheckout),console.log("has order?",hasOrder);store.getCustomerId(),store.getAdditionalFields(),store.getOrderId();const e=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway");function addScriptApple(){if(isMyScriptLoaded(e.importApplePayScript)){const t=document.createElement("script");t.src=e.importApplePayScript,document.body.append(t)}}function isMyScriptLoaded(e){for(var t=document.getElementsByTagName("script"),a=t.length;a--;)if(t[a].src==e)return!1;return!0}let t=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway").gateways;t=e.isSubscriptionOrder?["payplus-payment-gateway"]:t,t=e.isSubscriptionOrder&&e.isLoggedIn?["payplus-payment-gateway","payplus-payment-gateway-hostedfields"]:t;let a=[];const o=window.React;for(let i=0;i<e.customIcons?.length;i++)a[i]=(0,o.createElement)("img",{src:e.customIcons[i],style:{maxHeight:"35px",height:"45px"}});const n=(0,o.createElement)("div",{className:"payplus-icons",style:{display:"flex",flexWrap:"wrap",width:"100%",maxWidth:"100%",gap:"5px"}},a);let s=!!e.customIcons[0]?.length;Object.keys(e.hasSavedTokens).length;const l=e.hideMainPayPlusGateway;if(e.hostedFieldsIsMain){const{dispatch:r}=window.wp.data,c=window.wc.wcBlocksData.PAYMENT_STORE_KEY,p="payplus-payment-gateway-hostedfields";try{r(c).__internalSetActivePaymentMethod(p)}catch(d){}}var _payplusPollDone=!1,_payplusTvEffectInProgress=!1;function redirectWithTvEffect(t){if(!_payplusTvEffectInProgress){if(e&&e.popupTvEffect&&"popupIframe"===e.viewMode&&jQuery(".pp_iframe").length>0){_payplusTvEffectInProgress=!0,_payplusPollDone=!0;var a=jQuery(".pp_iframe");return a.css({position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)","z-index":"100000"}),a.addClass("tv-closing-blocks"),a[0].offsetHeight,void setTimeout(function(){window.location.href=t},1050)}window.location.href=t}}function startOrderStatusPoll(t){if(t&&t.order_id&&t.order_received_url){var a=t.order_received_url,o="";try{var n=new URL(a,window.location.origin);o=n.searchParams.get("key")||""}catch(e){return}if(o){var s=0;i();var l=setInterval(function(){_payplusPollDone?clearInterval(l):i()},150)}}function i(){_payplusPollDone||s++>600||jQuery.ajax({url:e.ajax_url||window.payplus_script?.ajax_url,type:"POST",data:{action:"payplus_check_order_redirect",_ajax_nonce:e.frontNonce||window.payplus_script?.frontNonce,order_id:t.order_id,order_key:o},dataType:"json",success:function(e){if(!_payplusPollDone&&e&&e.success&&e.data&&e.data.status){var t=e.data.status;"processing"!==t&&"completed"!==t&&"wc-processing"!==t&&"wc-completed"!==t||(_payplusPollDone=!0,redirectWithTvEffect(e.data.redirect_url||a))}}})}}function startIframe(t,a,o){document.body.appendChild(a),a.appendChild(o);const n=payment.getActivePaymentMethod(),s=window.wc.wcSettings.getPaymentMethodData(n)[n+"-settings"];var l=document.createElement("iframe");l.id="pp_iframe",l.name="payplus-iframe",l.width="95%",l.height="100%",l.style.border="0",l.style.display="block",l.style.margin="auto",l.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation"),l.src=t;let i=document.querySelectorAll(".pp_iframe"),r=document.querySelector(`#radio-control-wc-payment-method-options-${n}`).nextElementSibling.querySelector(".pp_iframe");if(-1!==["samePageIframe","popupIframe"].indexOf(s.displayMode)){if("payplus-payment-gateway"!==n)for(let e=0;e<i.length;e++){const t=i[e].parentNode.parentNode;if(t){t.id.includes(n)&&(r=i[e])}}switch(s.displayMode=window.innerWidth<=768&&"samePageIframe"===s.displayMode?"popupIframe":s.displayMode,s.displayMode){case"samePageIframe":r.style.position="relative",r.style.height=s.iFrameHeight,a.style.display="none";break;case"popupIframe":r.style.width=window.innerWidth<=768?"98%":s.iFrameWidth||"40%",r.style.height=s.iFrameHeight,r.style.position="fixed",r.style.top="50%",r.style.left="50%",r.style.paddingBottom=window.innerWidth<=768?"20px":"10px",r.style.paddingTop=window.innerWidth<=768?"20px":"10px",r.style.backgroundColor="white",r.style.transform="translate(-50%, -50%)",r.style.zIndex=1e5,r.style.boxShadow="10px 10px 10px 10px grey",r.style.borderRadius="5px",document.body.style.overflow="hidden",document.getElementsByClassName("blocks-payplus_loader")[0].style.display="none"}r.style.display="block",r.style.border="none",r.style.overflow="scroll",r.style.msOverflowStyle="none",r.style.scrollbarWidth="none",r.firstElementChild.style.display="block",r.firstElementChild.style.cursor="pointer",r.firstElementChild.addEventListener("click",e=>{e.preventDefault(),r.style.display="none";var t=window.location.href;new URLSearchParams(t);location.reload()}),r.appendChild(l),e.importApplePayScript&&addScriptApple()}}function multiPassIcons(e,t=null){null===t&&(t=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-multipass"));const a=wcSettings.paymentMethodSortOrder.includes("payplus-payment-gateway-multipass");if(e&&a&&Object.keys(wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons).length>0){const a=wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons;if(t){let t=function(e){let t=document.querySelectorAll("img");for(let a of t)if(a.src.includes(e))return a;return null}("multipassLogo.png");if(t){t.src;let o=0;const n=Object.keys(a).map(e=>a[e]);!function e(){const a=n[o];!function(e,t){e&&t?(e.style.transition="opacity 0.5s",e.style.opacity=0,setTimeout(()=>{e.src=t,e.style.opacity=1},500)):console.log("Image or new source not found.")}(t,a),o=(o+1)%n.length,Object.keys(wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons).length>1&&setTimeout(e,2e3)}(),e=!1}}}}window.addEventListener("message",function(e){if(e.data&&"payplus_redirect"===e.data.type&&e.data.url)try{new URL(e.data.url,window.location.origin).origin===window.location.origin&&(_payplusPollDone=!0,redirectWithTvEffect(e.data.url))}catch(e){}}),(()=>{const e=window.React,a=window.wc.wcBlocksRegistry,o=window.wp.i18n,l=window.wc.wcSettings,i=window.wp.htmlEntities,r=t,c=e=>(0,i.decodeEntities)(e.description||""),p=t=>{const{PaymentMethodLabel:a}=t.components;return(0,e.createElement)("div",{className:"payplus-method",style:{width:"100%"}},(0,e.createElement)(a,{text:t.text,icon:""!==t.icon?(0,e.createElement)("img",{style:{width:"64px",height:"32px",maxHeight:"100%",margin:"0px 10px",objectPosition:"center"},src:t.icon}):null}),(0,e.createElement)("div",{className:"pp_iframe"},(0,e.createElement)("button",{className:"closeFrame",id:"closeFrame",style:{position:"absolute",top:"0px",fontSize:"20px",right:"0px",border:"none",color:"black",backgroundColor:"transparent",display:"none"}},"x")),t.icon.search("PayPlusLogo.svg")>0&&s?n:null)};(()=>{for(let t=0;t<r.length;t++){const n=r[t],s=(0,l.getPaymentMethodData)(n,{}),d=(0,o.__)("Pay with Debit or Credit Card","payplus-payment-gateway"),y=(0,i.decodeEntities)(s?.title||"")||d,m={name:n,label:(0,e.createElement)(p,{text:y,icon:s.icon}),content:(0,e.createElement)(c,{description:s.description}),edit:(0,e.createElement)(c,{description:s.description}),canMakePayment:()=>!0,ariaLabel:y,supports:{showSaveOption:"payplus-payment-gateway"===n&&s.showSaveOption,features:s.supports}};(0,a.registerPaymentMethod)(m)}})()})(),document.addEventListener("DOMContentLoaded",function(){let e=!0;window.wc.wcSettings;var a=document.createElement("div");a.class="blocks-payplus_loader";const o=document.createElement("div");o.className="blocks-payplus_loader";const n=document.createElement("div");n.className="blocks-loader";const s=document.createElement("div");s.className="blocks-loader-background";const i=document.createElement("div");i.className="blocks-loader-text",s.appendChild(i),n.appendChild(s),o.appendChild(n),a.appendChild(o),setTimeout(function(){console.log("observer started");const o=document.createElement("div");o.style.backgroundColor="rgba(0, 0, 0, 0.5)",o.id="overlay",o.style.position="fixed",o.style.height="100%",o.style.width="100%",o.style.top="0",o.style.zIndex="5",setTimeout(()=>{let t=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-multipass");e&&t&&(multiPassIcons(e,t),e=!1)},3e3),payPlusCC=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway");const n=new MutationObserver((e,n)=>{const s=payment.getActivePaymentMethod();if(0===s.search("payplus-payment-gateway-hostedfields")){const e=document.getElementsByClassName("pp_iframe_h")[0];if(e&&(e.style.display="flex",!e.querySelector(".payplus-hosted-place-order"))){const t=document.querySelector(".wc-block-checkout__actions_row button"),a=e.querySelector("#ppLogo"),o=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway-hostedfields"),n=o&&"yes"===o.show_hide_submit_button;if(t&&a&&n){const e=document.createElement("button");e.className="btn btn-primary payplus-hosted-place-order wp-element-button wc-block-components-button wp-element-button contained",e.type="button";const o=document.createElement("span");o.className="button-text",o.textContent=t.textContent;const n=document.createElement("span");n.className="button-loader",n.style.cssText="display: none; margin-left: 8px;",n.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="animation: spin 1s linear infinite; vertical-align: middle;"><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="30 10" /></svg>',e.appendChild(o),e.appendChild(n),e.style.cssText="\n                                    margin-top: 15px;\n                                    margin-bottom: 15px;\n                                    margin-right: auto;\n                                    margin-left: auto;\n                                    width: 90%;\n                                    background-color: rgb(0, 0, 0);\n                                    color: white;\n                                    border: none;\n                                    border-radius: 10px;\n                                    padding: 12px 24px;\n                                    font-size: 16px;\n                                    font-weight: 600;\n                                    cursor: pointer;\n                                ",e.addEventListener("click",function(a){a.preventDefault(),e.disabled=!0,e.style.opacity="0.7";const o=e.querySelector(".button-loader");o&&(o.style.display="inline-block"),t.click()}),a.parentNode.insertBefore(e,a)}}}else{const e=document.getElementsByClassName("pp_iframe_h")[0];e&&(e.style.display="none")}if(l){const e=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway")?.closest(".wc-block-components-radio-control-accordion-option");e&&(e.style.display="none")}if(store.hasError())try{let e=payment.getPaymentResult();if(null==e||""===e)throw new Error("Payment result is empty, null, or undefined.");console.log("Payment result:",e);let t=document.querySelectorAll(".pp_iframe")[0];t.style.width=window.innerWidth<=768?"95%":"55%",t.style.height="200px",t.style.position="fixed",t.style.backgroundColor="white",t.style.display="flex",t.style.alignItems="center",t.style.textAlign="center",t.style.justifyContent="center",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex=1e5,t.style.boxShadow="10px 10px 10px 10px grey",t.style.borderRadius="25px",t.innerHTML=void 0!==e.paymentDetails.errorMessage?e.paymentDetails.errorMessage+"<br>"+(window.payplus_i18n&&window.payplus_i18n.click_to_close?window.payplus_i18n.click_to_close:"Click this to close."):e.message+"<br>"+(window.payplus_i18n&&window.payplus_i18n.click_to_close?window.payplus_i18n.click_to_close:"Click this to close."),t.addEventListener("click",e=>{e.preventDefault(),t.style.display="none",location.reload()}),console.log(e.paymentDetails.errorMessage),void 0!==e.paymentDetails.errorMessage?alert(e.paymentDetails.errorMessage):alert(e.message),n.disconnect()}catch(e){console.error("An error occurred:",e.message)}if(store.isComplete()){if(n.disconnect(),0===s.search("payplus-payment-gateway-hostedfields")){hf.SubmitPayment(),document.body.style.overflow="hidden",document.body.style.backgroundColor="white",document.body.style.opacity="0.7",document.querySelector(".blocks-payplus_loader_hosted").style.display="block";return document.querySelectorAll('input[type="radio"], input').forEach(e=>{e.disabled=!0}),void hf.Upon("pp_responseFromServer",e=>{e.detail.errors&&location.reload()})}if(0===s.search("payplus-payment-gateway")&&0!==s.search("payplus-payment-gateway-pos-emv")){const e=window.wc.wcSettings.getPaymentMethodData(s)[s+"-settings"],l=-1!==["samePageIframe","popupIframe"].indexOf(e.displayMode);if(console.log("isIframe?",l),-1!==t.indexOf(payment.getActivePaymentMethod())&&0===payment.getActiveSavedToken().length){if(console.log("isComplete: "+store.isComplete()),l){var i=payment.getPaymentResult().paymentDetails;i.payplus_iframe_async?(startOrderStatusPoll({order_id:i.order_id,order_received_url:i.order_received_url}),startIframe("about:blank",o,a),jQuery.ajax({type:"POST",url:payplus_script.ajax_url,data:{action:"payplus_get_iframe_link",_ajax_nonce:payplus_script.frontNonce,order_id:i.order_id,order_key:i.order_key},success:function(e){if(e.success&&e.data&&e.data.payment_page_link){var t=document.getElementById("pp_iframe");t&&(t.src=e.data.payment_page_link)}else{var a=e.data&&e.data.message?e.data.message:window.payplus_i18n&&window.payplus_i18n.payment_page_failed?window.payplus_i18n.payment_page_failed:"Error: the payment page failed to load.";alert(a),location.reload()}},error:function(){alert(window.payplus_i18n&&window.payplus_i18n.payment_page_failed?window.payplus_i18n.payment_page_failed:"Error: the payment page failed to load."),location.reload()}})):i.paymentPageLink&&i.paymentPageLink.length>0?(console.log("paymentPageLink",i.paymentPageLink),startIframe(i.paymentPageLink,o,a),i.order_id&&i.order_received_url&&startOrderStatusPoll({order_id:i.order_id,order_received_url:i.order_received_url})):(alert(window.payplus_i18n&&window.payplus_i18n.payment_page_failed?window.payplus_i18n.payment_page_failed:"Error: the payment page failed to load."),location.reload())}n.disconnect()}}}}),s=document.body;n.observe(s,{childList:!0,subtree:!0})}(),1e3)})}