let CHECKOUT_STORE_KEY=window.wc.wcBlocksData["CHECKOUT_STORE_KEY"],PAYMENT_STORE_KEY=window.wc.wcBlocksData["PAYMENT_STORE_KEY"],store=wp.data.select(CHECKOUT_STORE_KEY),payment=wp.data.select(PAYMENT_STORE_KEY),hasOrder=store.hasOrder(),isCheckout=!!document.querySelector('div[data-block-name="woocommerce/checkout"]');if(isCheckout||hasOrder){console.log("checkout page?",isCheckout),console.log("has order?",hasOrder);let e=store.getCustomerId(),t=store.getAdditionalFields(),a=store.getOrderId(),r=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway");function addScriptApple(){var e;isMyScriptLoaded(r.importApplePayScript)&&((e=document.createElement("script")).src=r.importApplePayScript,document.body.append(e))}function isMyScriptLoaded(e){for(var t=document.getElementsByTagName("script"),a=t.length;a--;)if(t[a].src==e)return!1;return!0}let y=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway").gateways,o=(y=r.isSubscriptionOrder?["payplus-payment-gateway"]:y,y=r.isSubscriptionOrder&&r.isLoggedIn?["payplus-payment-gateway","payplus-payment-gateway-hostedfields"]:y,[]),n=window.React;for(let e=0;e<r.customIcons?.length;e++)o[e]=(0,n.createElement)("img",{src:r.customIcons[e],style:{maxHeight:"35px",height:"45px"}});let m=(0,n.createElement)("div",{className:"payplus-icons",style:{display:"flex",flexWrap:"wrap",width:"100%",maxWidth:"100%",gap:"5px"}},o),u=!!r.customIcons[0]?.length,l=0<Object.keys(r.hasSavedTokens).length,p=r.hideMainPayPlusGateway,s=r.hostedFieldsIsMain;if(s){let e=window.wp.data["dispatch"],t=window.wc.wcBlocksData.PAYMENT_STORE_KEY,a="payplus-payment-gateway-hostedfields";try{e(t).__internalSetActivePaymentMethod(a)}catch(e){}}function startIframe(e,t,a){document.body.appendChild(t),t.appendChild(a);var o=payment.getActivePaymentMethod(),n=window.wc.wcSettings.getPaymentMethodData(o)[o+"-settings"],a=document.createElement("iframe"),l=(a.width="95%",a.height="100%",a.style.border="0",a.style.display="block",a.style.margin="auto",a.src=e,document.querySelectorAll(".pp_iframe"));let s=document.querySelector("#radio-control-wc-payment-method-options-"+o).nextElementSibling.querySelector(".pp_iframe");if(-1!==["samePageIframe","popupIframe"].indexOf(n.displayMode)){if("payplus-payment-gateway"!==o)for(let e=0;e<l.length;e++){var i=l[e].parentNode.parentNode;i&&i.id.includes(o)&&(s=l[e])}switch(n.displayMode=window.innerWidth<=768&&"samePageIframe"===n.displayMode?"popupIframe":n.displayMode,n.displayMode){case"samePageIframe":s.style.position="relative",s.style.height=n.iFrameHeight,t.style.display="none";break;case"popupIframe":s.style.width=window.innerWidth<=768?"98%":n.iFrameWidth||"40%",s.style.height=n.iFrameHeight,s.style.position="fixed",s.style.top="50%",s.style.left="50%",s.style.paddingBottom=window.innerWidth<=768?"20px":"10px",s.style.paddingTop=window.innerWidth<=768?"20px":"10px",s.style.backgroundColor="white",s.style.transform="translate(-50%, -50%)",s.style.zIndex=1e5,s.style.boxShadow="10px 10px 10px 10px grey",s.style.borderRadius="5px",document.body.style.overflow="hidden",document.getElementsByClassName("blocks-payplus_loader")[0].style.display="none"}s.style.display="block",s.style.border="none",s.style.overflow="scroll",s.style.msOverflowStyle="none",s.style.scrollbarWidth="none",s.firstElementChild.style.display="block",s.firstElementChild.style.cursor="pointer",s.firstElementChild.addEventListener("click",e=>{e.preventDefault(),s.style.display="none";e=window.location.href;new URLSearchParams(e);location.reload()}),s.appendChild(a),r.importApplePayScript&&addScriptApple()}}function multiPassIcons(e,a=null){null===a&&(a=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-multipass"));var t=wcSettings.paymentMethodSortOrder.includes("payplus-payment-gateway-multipass");if(e&&t&&0<Object.keys(wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons).length){let t=wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons;if(a){let s=function(e){var t;for(t of document.querySelectorAll("img"))if(t.src.includes(e))return t;return null}("multipassLogo.png");if(s){s.src;let n=0,l=Object.keys(t).map(e=>t[e]);!function e(){var t,a,o=l[n];t=s,a=o,t&&a?(t.style.transition="opacity 0.5s",t.style.opacity=0,setTimeout(()=>{t.src=a,t.style.opacity=1},500)):console.log("Image or new source not found."),n=(n+1)%l.length,1<Object.keys(wcSettings.paymentMethodData["payplus-payment-gateway"].multiPassIcons).length&&setTimeout(e,2e3)}()}}}}(()=>{let a=window.React,t=window.wc.wcBlocksRegistry,o=window.wp.i18n,n=window.wc.wcSettings,l=window.wp.htmlEntities,s=y,i=e=>(0,l.decodeEntities)(e.description||""),r=e=>{var t=e.components["PaymentMethodLabel"];return(0,a.createElement)("div",{className:"payplus-method",style:{width:"100%"}},(0,a.createElement)(t,{text:e.text,icon:""!==e.icon?(0,a.createElement)("img",{style:{width:"64px",height:"32px",maxHeight:"100%",margin:"0px 10px",objectPosition:"center"},src:e.icon}):null}),(0,a.createElement)("div",{className:"pp_iframe"},(0,a.createElement)("button",{className:"closeFrame",id:"closeFrame",style:{position:"absolute",top:"0px",fontSize:"20px",right:"0px",border:"none",color:"black",backgroundColor:"transparent",display:"none"}},"x")),0<e.icon.search("PayPlusLogo.svg")&&u?m:null)};for(let e=0;e<s.length;e++){var p=s[e],d=(0,n.getPaymentMethodData)(p,{}),c=(0,o.__)("Pay with Debit or Credit Card","payplus-payment-gateway"),c=(0,l.decodeEntities)(d?.title||"")||c,c={name:p,label:(0,a.createElement)(r,{text:c,icon:d.icon}),content:(0,a.createElement)(i,{description:d.description}),edit:(0,a.createElement)(i,{description:d.description}),canMakePayment:()=>!0,ariaLabel:c,supports:{showSaveOption:"payplus-payment-gateway"===p&&d.showSaveOption,features:d.supports}};(0,t.registerPaymentMethod)(c)}})(),document.addEventListener("DOMContentLoaded",function(){let a=!0;window.wc.wcSettings;var i=document.createElement("div"),e=(i.class="blocks-payplus_loader",document.createElement("div")),t=(e.className="blocks-payplus_loader",document.createElement("div")),o=(t.className="blocks-loader",document.createElement("div")),n=(o.className="blocks-loader-background",document.createElement("div"));function l(){var e=document.querySelector(".wc-block-checkout__actions_row button");e&&!e.hasAttribute("data-payplus-listener")&&(e.setAttribute("data-payplus-listener","true"),e.addEventListener("click",function(){var l=payment.getActivePaymentMethod();if(l&&l.includes("payplus-payment-gateway")){var s=document.createElement("div"),i=(s.id="early-payplus-overlay",s.style.cssText=`
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.5);
                            z-index: 999999;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        `,document.createElement("div"));i.style.cssText=`
                            background: white;
                            padding: 30px 50px;
                            border-radius: 12px;
                            text-align: center;
                            color: #333;
                            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                            min-width: 300px;
                        `;let e=document.createElement("div"),t=(e.style.cssText=`
                            font-size: 18px;
                            font-weight: 500;
                            margin-bottom: 15px;
                        `,document.createElement("div")),a=(t.style.cssText=`
                            font-size: 24px;
                            color: #007cba;
                        `,i.appendChild(e),i.appendChild(t),s.appendChild(i),document.body.appendChild(s),0);let o=setInterval(()=>{a=a%3+1,t.textContent=".".repeat(a)},400),n=("payplus-payment-gateway-hostedfields"===l?e.textContent=window.payplus_i18n&&window.payplus_i18n.processing_payment?window.payplus_i18n.processing_payment:"Processing your payment now":(e.textContent=window.payplus_i18n&&window.payplus_i18n.generating_page?window.payplus_i18n.generating_page:"Generating payment page",i=1e3*Math.random()+4e3,setTimeout(()=>{e.textContent=window.payplus_i18n&&window.payplus_i18n.loading_page?window.payplus_i18n.loading_page:"Loading payment page"},i)),setInterval(()=>{var e;(store.isComplete()||store.hasError())&&(clearInterval(o),clearInterval(n),e=document.getElementById("early-payplus-overlay"))&&e.remove()},100));setTimeout(()=>{clearInterval(o),clearInterval(n);var e=document.getElementById("early-payplus-overlay");e&&e.remove()},15e3)}}))}n.className="blocks-loader-text",o.appendChild(n),t.appendChild(o),e.appendChild(t),i.appendChild(e),l();let s=setInterval(()=>{l()},1e3);setTimeout(()=>{clearInterval(s)},1e4),setTimeout(function(){console.log("observer started");let s=document.createElement("div");s.style.backgroundColor="rgba(0, 0, 0, 0.5)",s.id="overlay",s.style.position="fixed",s.style.height="100%",s.style.width="100%",s.style.top="0",s.style.zIndex="5",setTimeout(()=>{var e=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway-multipass");a&&e&&(multiPassIcons(a,e),a=!1)},3e3),payPlusCC=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway");var e=new MutationObserver((e,a)=>{var t=payment.getActivePaymentMethod();if(0===t.search("payplus-payment-gateway-hostedfields")){var o=document.getElementsByClassName("pp_iframe_h")[0];if(o&&(o.style.display="flex",!o.querySelector(".payplus-hosted-place-order"))){let t=document.querySelector(".wc-block-checkout__actions_row button");var o=o.querySelector("#ppLogo"),n=window.wc.wcSettings.getPaymentMethodData("payplus-payment-gateway-hostedfields"),n=n&&"yes"===n.show_hide_submit_button;t&&o&&n&&((n=document.createElement("button")).className="btn btn-primary payplus-hosted-place-order wp-element-button wc-block-components-button wp-element-button contained",n.type="button",n.textContent=t.textContent,n.style.cssText=`
                                    margin-top: 15px;
                                    margin-bottom: 15px;
                                    margin-right: auto;
                                    margin-left: auto;
                                    width: 90%;
                                    background-color: rgb(0, 0, 0);
                                    color: white;
                                    border: none;
                                    border-radius: 10px;
                                    padding: 12px 24px;
                                    font-size: 16px;
                                    font-weight: 600;
                                    cursor: pointer;
                                `,n.addEventListener("click",function(e){e.preventDefault(),t.click()}),o.parentNode.insertBefore(n,o))}}else{n=document.getElementsByClassName("pp_iframe_h")[0];n&&(n.style.display="none")}if(p&&(o=document.querySelector("#radio-control-wc-payment-method-options-payplus-payment-gateway")?.closest(".wc-block-components-radio-control-accordion-option"))&&(o.style.display="none"),store.hasError())try{var l=payment.getPaymentResult();if(null==l||""===l)throw new Error("Payment result is empty, null, or undefined.");console.log("Payment result:",l);let t=document.querySelectorAll(".pp_iframe")[0];t.style.width=window.innerWidth<=768?"95%":"55%",t.style.height="200px",t.style.position="fixed",t.style.backgroundColor="white",t.style.display="flex",t.style.alignItems="center",t.style.textAlign="center",t.style.justifyContent="center",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex=1e5,t.style.boxShadow="10px 10px 10px 10px grey",t.style.borderRadius="25px",t.innerHTML=void 0!==l.paymentDetails.errorMessage?l.paymentDetails.errorMessage+"<br>"+(window.payplus_i18n&&window.payplus_i18n.click_to_close?window.payplus_i18n.click_to_close:"Click this to close."):l.message+"<br>"+(window.payplus_i18n&&window.payplus_i18n.click_to_close?window.payplus_i18n.click_to_close:"Click this to close."),t.addEventListener("click",e=>{e.preventDefault(),t.style.display="none",location.reload()}),console.log(l.paymentDetails.errorMessage),void 0!==l.paymentDetails.errorMessage?alert(l.paymentDetails.errorMessage):alert(l.message),a.disconnect()}catch(e){console.error("An error occurred:",e.message)}store.isComplete()&&(a.disconnect(),0===t.search("payplus-payment-gateway-hostedfields")?(hf.SubmitPayment(),document.body.style.overflow="hidden",document.body.style.backgroundColor="white",document.body.style.opacity="0.7",document.querySelector(".blocks-payplus_loader_hosted").style.display="block",document.querySelectorAll('input[type="radio"], input').forEach(e=>{e.disabled=!0}),hf.Upon("pp_responseFromServer",e=>{e.detail.errors&&location.reload()})):0===t.search("payplus-payment-gateway")&&0!==t.search("payplus-payment-gateway-pos-emv")&&(n=window.wc.wcSettings.getPaymentMethodData(t)[t+"-settings"],o=-1!==["samePageIframe","popupIframe"].indexOf(n.displayMode),console.log("isIframe?",o),-1!==y.indexOf(payment.getActivePaymentMethod()))&&0===payment.getActiveSavedToken().length&&(console.log("isComplete: "+store.isComplete()),o&&(0<payment.getPaymentResult().paymentDetails.paymentPageLink?.length?(console.log("paymentPageLink",payment.getPaymentResult().paymentDetails.paymentPageLink),startIframe(payment.getPaymentResult().paymentDetails.paymentPageLink,s,i)):(alert(window.payplus_i18n&&window.payplus_i18n.payment_page_failed?window.payplus_i18n.payment_page_failed:"Error: the payment page failed to load."),location.reload())),a.disconnect()))}),t=document.body;e.observe(t,{childList:!0,subtree:!0})}(),1e3)});let i=(e=!1)=>{e?$overlay&&($overlay.remove(),jQuery("body").css({overflow:""}),$overlay=null):$overlay||($overlay=jQuery("<div></div>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999,cursor:"not-allowed"}).appendTo("body"),jQuery("body").css({overflow:"hidden"}),$overlay.on("click",function(e){e.stopPropagation(),e.preventDefault()}))}}